(function(e){var c={main:"veryform",elem:"veryform-item",wrap:"veryform-wrap",warning:"veryform-warning",positive:"veryform-true",negative:"veryform-false",failure:"veryform-failure",success:"veryform-success",js:"js-veryform"};if(window.veryform===undefined){window.veryform={}}window.veryform.classnames=c;function b(g){var f=".";return f+g+" "}var d=(function(){var g={text:"/[^\\s]+/i",email:"/^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+.[a-zA-Z0-9-.]+$/i",checkbox:1,textarea:"/[^\\s]+/i",radio:1,select:1,file:true,password:"/[^\\s]+/i"};var f={text:"nothing was written",email:"incorrect email",checkbox:"choose something",textarea:"nothing was written",radio:"choose something",select:"choose something",file:"choose the file",password:"incorrect password"};var h=function(i,j){this.$instance;this.elems=e();this.datas={};this.defaults={wrap:true,displayWarnings:true,maxFileSize:5000000,validateOnSubmit:true,init:true,autoinit:false,on:"keyup",exclude:"",autocomplete:false,regex:{},warnings:{}};this.elemsCounter=0;this.updateOptions(j);this.$instance=i;if(typeof i==="string"){this.$instance=e(i)}var k=this.$instance.data("veryform");if(k){return k}if(this.defaults.init){this.init()}};h.prototype.updateOptions=function(i){i?e.extend(this.defaults,i):"";this.updateData(this.elems)};h.prototype.init=function(){var i=this;i.$instance.find("input[type!=submit][type!=hidden][type!=reset], textarea, select").each(function(){i.add(e(this))});i.setHandlers()};h.prototype.add=function(i){var j=this;i.each(function(){var m=e(this);var l=m.attr("type");var k=m.attr("name");switch(l){case"radio":case"checkbox":if(!k){m.remove();return}break;default:}j.updateData(m);j.setShouldbe(m);j.valid(m);if(j.defaults.autoinit){j.valid(m);j.performAction(m);j.checkGlobalStatus()}if(j.$instance.find(j.defaults.exclude).is(m)){j.exclude(m)}else{j.elems=j.elems.add(m)}})};h.prototype.updateData=function(i){var j=this;i.each(function(){var o=e(this);var p=o.data(window.veryform.classnames.main);if(!p){j.repairType(o);var l=o.attr("name");var n=o.attr("type");var k={};var p={};k.id=j.elemsCounter;k.data=p;k.validOnStart=false;for(var m in j.datas.elems){if(j.datas.elems[m]["data"]["name"]==l){j.datas.elems[m]["data"]["sum"]++;k.data=j.datas.elems[m]["data"];j.datas.elems.push(k);o.data(window.veryform.classnames.main,k);j.applyHandler(o);j.elemsCounter++;return}}p.elem=o;p.type=n?n:o[0]["localName"];p.name=l;p.valid=false;p.sum=1;p.is=0;p.wrapped=false;p.shouldbe=0;k.eventHandler=undefined;k.eventName=undefined;!j.datas.elems?j.datas.elems=[]:"";j.datas.elems.push(k);o.data(window.veryform.classnames.main,k);j.elemsCounter++;j.applyHandler(o);o.addClass(window.veryform.classnames.elem)}j.applyRegex(o);j.applyWarnings(o);o.removeAttr("required");!j.defaults.autocomplete?o.attr("autocomplete","off"):""})};h.prototype.applyRegex=function(l){var k=this;var m=l.data(window.veryform.classnames.main);for(var j in k.defaults.regex){if(k.$instance.find(j).is(l)){k.setDataParameter(l,"regex",k.defaults.regex[j]);k.repairRegex(l);return}}k.setDataParameter(l,"regex",g[m.data["type"]]);k.repairRegex(l)};h.prototype.applyWarnings=function(l){var k=this;var m=l.data(window.veryform.classnames.main);for(var j in k.defaults.warnings){if(k.$instance.find(j).is(l)){k.setDataParameter(l,"warning",k.defaults.warnings[j]);k.wrap(l);k.appendWarning(l);return}}k.setDataParameter(l,"warning",f[m.data["type"]]);k.wrap(l);k.appendWarning(l)};h.prototype.exclude=function(i){var j=this;i.each(function(){var m=e(this);var n=m.data(window.veryform.classnames.main);j.off(m,n.eventName,n.eventHandler);n.data["sum"]--;for(var l in j.datas.elems){var k=parseInt(l);if(j.datas.elems[k]["id"]==n.id){j.datas.elems.splice(k,1);break}}j.unwrap(m);m.removeData(window.veryform.classnames.main);j.elems=j.elems.not(m)})};h.prototype.setDataParameter=function(j,i,l){var k=j.data(window.veryform.classnames.main);k.data[i]=l};h.prototype.repairType=function(i){i[0]["localName"]=="input"&&!i.attr("type")?i.attr("type","text"):""};h.prototype.repairRegex=function(l){var k=this;var m=l.data(window.veryform.classnames.main);var j=m.data["type"];var i=m.data["regex"];switch(j){case"text":case"textarea":case"email":case"password":!i.match(/^\/.*\/[img]{1,3}/g)?k.setDataParameter(l,"regex",g[j]):"";break;case"radio":case"checkbox":case"select":isNaN(i)?k.setDataParameter(l,"regex",g[j]):"";break;case"file":i!==true&&i!==false?k.setDataParameter(l,"regex",g[j]):"";break}};h.prototype.setShouldbe=function(j){var i=this;var k=j.data(window.veryform.classnames.main);switch(k.data["type"]){case"radio":case"checkbox":k.data["shouldbe"]=k.data["regex"];break;case"select":k.data["shouldbe"]=k.data["regex"];break;case"file":k.data["shouldbe"]=k.data["regex"]==true?1:0;k.data["maxFileSize"]=i.defaults.maxFileSize;break;default:k.data["shouldbe"]++;break}};h.prototype.valid=function(m){var l=this;var o=m.data(window.veryform.classnames.main);var j=o.validOnStart;switch(o.data["type"]){case"text":case"email":case"password":case"textarea":var k=o.data["regex"].match(/\/(.*)\/(.*)/);
var n=m.val();var i=new RegExp(k[1],k[2]);o.data["is"]=n.match(i)?Math.min(++o.data["is"],1):Math.max(--o.data["is"],0);break;case"radio":m.is(":checked")?o.data["is"]=1:j?o.data["is"]=0:"";break;case"checkbox":m.is(":checked")?o.data["is"]++:j?o.data["is"]--:"";break;case"select":var n=m.val();o.data["is"]=n.match(/.+/i)?1:0;break;case"file":var n=m.val();o.data["is"]=n.length>0&&o.data["recentFileSize"]&&(o.recentFileSize<=o.maxFileSize)?1:0;break}o.validOnStart=true;l.checkStatus(m)};h.prototype.checkStatus=function(i){var j=i.data(window.veryform.classnames.main);j.data["valid"]=j.data["is"]>=j.data["shouldbe"]?true:false};h.prototype.performAction=function(i){var j=i.data(window.veryform.classnames.main);j.data["valid"]?i.trigger("ontrue"):i.trigger("onfalse")};h.prototype.wrap=function(n){var m=this;var o=n.data(window.veryform.classnames.main);var l=o.data["type"];var k=o.data["name"];var i=undefined;if(m.defaults.wrap&&!o.data["wrapped"]){var j=e();switch(l){case"radio":case"checkbox":i=e("[name="+k+"]");break;default:i=n}var p=e('<div class="'+window.veryform.classnames.wrap+" veryform_"+o.data["name"]+" veryform_"+o.data["type"]+'" />');j=j.add(i);i.each(function(){j=j.add(e(this).parents("form").find("label[for="+e(this).attr("id")+"]"))});j.wrapAll(p);o.data["wrapped"]=true}};h.prototype.unwrap=function(i){i.each(function(){var m=e(this);var n=m.data(window.veryform.classnames.main);if(n.data["wrapped"]){var k=n.data["name"];var l=m.parents(b(window.veryform.classnames.wrap));var j=e();e("[name="+k+"]").each(function(){j=j.add(e(this));j=j.add(e(this).parents("form").find("label[for="+e(this).attr("id")+"]"))});l.find(b(window.veryform.classnames.warning)).remove();j.unwrap();n.data["wrapped"]=false}})};h.prototype.appendWarning=function(k){var j=this;var m=k.data(window.veryform.classnames.main);var i=e("<span>").addClass(window.veryform.classnames.warning).text(m.data["warning"]).css("display","none");var l=k.parents(b(window.veryform.classnames.wrap));if(!l.find(b(window.veryform.classnames.warning)).length){l.append(i)}else{l.find(b(window.veryform.classnames.warning)).html(m.data["warning"])}};h.prototype.on=function(k,i,j){k.on(i,j)};h.prototype.off=function(k,i,j){k.off(i,j)};h.prototype.applyHandler=function(m){var l=this;var n=m.data(window.veryform.classnames.main);var k=n.data["type"];var j=undefined;var i=undefined;switch(k){case"radio":case"checkbox":case"select":i="change init";j=function(){l.valid(m);l.performAction(m);l.checkGlobalStatus()};break;case"text":case"email":case"password":case"textarea":i=l.defaults.on+" init";j=function(o){var p=o.which;if(p!=9){l.valid(m);l.performAction(m);l.checkGlobalStatus()}};break;case"file":i="change click init";j=function(){var o=this.files[0]?this.files[0].size/1024:undefined;n.data["recentFileSize"]=o;l.valid(m);l.performAction(m);l.checkGlobalStatus()};break}n.eventName=i;n.eventHandler=j;l.on(m,i,j);l.on(m,"ontrue",function(){if(l.defaults.displayWarnings){m.parents(b(window.veryform.classnames.wrap)).find(b(window.veryform.classnames.warning)).hide(300);m.parents(b(window.veryform.classnames.wrap)).removeClass(window.veryform.classnames.negative).addClass(window.veryform.classnames.positive)}});l.on(m,"onfalse",function(){if(l.defaults.displayWarnings){m.parents(b(window.veryform.classnames.wrap)).find(b(window.veryform.classnames.warning)).show(300);m.parents(b(window.veryform.classnames.wrap)).removeClass(window.veryform.classnames.positive).addClass(window.veryform.classnames.negative)}})};h.prototype.setHandlers=function(j){var i=this;i.$instance.submit(function(o){if(i.defaults.validateOnSubmit){var n=false;var k=false;for(var l in i.datas.elems){if(!i.datas.elems[l]["data"]["valid"]){k=true;var m=i.datas.elems[l]["data"]["elem"];m.trigger("onfalse");if(!n){m.focus();n=true}}}if(k){o.preventDefault();o.stopPropagation();o.stopImmediatePropagation()}}})};h.prototype.checkGlobalStatus=function(){var l=this;var j=true;for(var k in l.datas.elems){if(!l.datas.elems[k]["data"]["valid"]){j=false;l.$instance.removeClass(window.veryform.classnames.success).addClass(window.veryform.classnames.failure);return}}l.$instance.removeClass(window.veryform.classnames.failure).addClass(window.veryform.classnames.success)};return h})();window.Veryform=d;var a=e(b(window.veryform.classnames.js));a.each(function(){var f=e(this);var g=JSON.parse(f.attr("data-veryform-options"));var h=new d(f,g);e(this).data(window.veryform.classnames.main,h)});e.fn.veryform=function(f){e(this).each(function(){var g=e(this);var h=new d(g,f);e(this).addClass(window.veryform.classnames.js);e(this).data(window.veryform.classnames.main,h)})}}(jQuery));